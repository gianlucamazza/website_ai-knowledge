version: 2

updates:
  # Node.js dependencies for the Astro site
  - package-ecosystem: "npm"
    directory: "/apps/site"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "UTC"
    commit-message:
      prefix: "chore(deps):"
      prefix-development: "chore(dev-deps):"
      include: "scope"
    reviewers:
      - "devops-team"
    assignees:
      - "devops-team"
    labels:
      - "dependencies"
      - "automated"
    open-pull-requests-limit: 5
    allow:
      - dependency-type: "direct"
      - dependency-type: "indirect"
    ignore:
      # Ignore major version updates for core dependencies that require manual testing
      - dependency-name: "astro"
        update-types: ["version-update:semver-major"]
      - dependency-name: "@astrojs/*"
        update-types: ["version-update:semver-major"]
      - dependency-name: "typescript"
        update-types: ["version-update:semver-major"]

  # Python dependencies for the content pipeline
  - package-ecosystem: "pip"
    directory: "/pipelines"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "10:00"
      timezone: "UTC"
    commit-message:
      prefix: "chore(deps):"
      include: "scope"
    reviewers:
      - "devops-team"
    assignees:
      - "devops-team"
    labels:
      - "dependencies"
      - "automated"
      - "python"
    open-pull-requests-limit: 5
    allow:
      - dependency-type: "direct"
      - dependency-type: "indirect"
    ignore:
      # Ignore major version updates for critical ML dependencies
      - dependency-name: "openai"
        update-types: ["version-update:semver-major"]
      - dependency-name: "anthropic"
        update-types: ["version-update:semver-major"]
      - dependency-name: "sqlalchemy"
        update-types: ["version-update:semver-major"]
      # Ignore minor updates for stable ML libraries (too frequent)
      - dependency-name: "scikit-learn"
        update-types: ["version-update:semver-minor"]
      - dependency-name: "sentence-transformers"
        update-types: ["version-update:semver-minor"]

  # GitHub Actions workflow dependencies
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "tuesday"
      time: "09:00"
      timezone: "UTC"
    commit-message:
      prefix: "chore(ci):"
      include: "scope"
    reviewers:
      - "devops-team"
    labels:
      - "dependencies"
      - "automated"
      - "ci"
    open-pull-requests-limit: 3

  # Docker dependencies (if using containers)
  - package-ecosystem: "docker"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "wednesday"
      time: "09:00"
      timezone: "UTC"
    commit-message:
      prefix: "chore(docker):"
      include: "scope"
    reviewers:
      - "devops-team"
    labels:
      - "dependencies"
      - "automated"
      - "docker"
    open-pull-requests-limit: 2

# Groups for related dependencies that should be updated together
groups:
  # Astro ecosystem updates
  astro-ecosystem:
    patterns:
      - "@astrojs/*"
      - "astro"
    
  # TypeScript ecosystem updates
  typescript-ecosystem:
    patterns:
      - "typescript"
      - "@types/*"
    
  # Linting and formatting tools
  code-quality:
    patterns:
      - "eslint*"
      - "@typescript-eslint/*"
      - "prettier"
      - "markdownlint*"
    
  # Testing frameworks
  testing-tools:
    patterns:
      - "pytest*"
      - "@testing-library/*"
      - "vitest"
    
  # Security tools
  security-tools:
    patterns:
      - "bandit"
      - "safety"
      - "semgrep"
    
  # Database and ORM
  database-tools:
    patterns:
      - "sqlalchemy"
      - "alembic"
      - "asyncpg"
      - "psycopg*"
    
  # AI/ML libraries (group to avoid conflicts)
  ml-libraries:
    patterns:
      - "openai"
      - "anthropic"
      - "langchain*"
      - "sentence-transformers"